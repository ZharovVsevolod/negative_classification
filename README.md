# Описание задачи
Одним из приоритетов бизнеса является создание лучшего клиентского опыта, поэтому для компании важно понимать текущий уровень CSI (customer satisfaction index) и его динамику (для оценки эффекта изменений в бизнес-процессах).  
С этой целью, разработан автоматический механизм сбора обратной связи по заказам. Кроме общей оценки удовлетворённости, клиенты оставляют обратную связь в виде текстового комментария/отзыва в свободной форме.  
Необходимо обучить модель классификации негативных отзывов, которая позволит получать детальную аналитику по проблемам клиентов в автоматическом режиме.

# Краткое описание способа решения задачи

Предобработка текста осуществлялась с помощью `лемматизации` и `очистки` от ненужных слов и символов (стоп-слова, пунктуация, смайлики и тд)  
Токенизация с помощью библиотеки `youtokentome` по методу `Byte Pair Encoding`, мешка n-грамм. Библиотека написана на С++, поэтому для её работы нужно обязательно Miscrosoft Visual Studio Build Tools для Windows или gcc++ для Linux. Без этих инструментов библиотека работать `не будет` (пример установки на linux с requirements.txt приведён в `Dockerfile`).  
Модель `BERT`-архитектуры, написанная с помощью собственных блоков. Для обучения используется `lightning` и `hydra` для менеджмента конфигов.  
Итоговая модель выгружена в формат `onnx`.  

В файле `model.py` в папке пакета `negative_classification` есть функция `get_result` для получения результата.


# Обучение модели
Наилучший результат - `74%` точности по `f1 метрике`  
Прогон обучения модели осуществлялся с логированием результатов на [wandb](https://wandb.ai/lost_in_thoughts/NLP_Neg)

Названия запусков обучения строятся по следующему принципу:
- `v`: размер словаря
- `ch`: максимальная (и единая) длина отзыва в токенах
- `l`: количество слоёв у модели
- `h`: количество голов self-attention
- `emb`: размерность эмбеддинга
- `mlp`: размерность скрытого слоя в mlp-классификаторе
- `d`: значение dropout
- `lr`: изначальная скорость обучения

# Описание возможных проблем

1) Не удалось установить пакет youtokentome при выполнении команды pip install -r requirements.txt. Ошибка `No module named Cython`
    - Решение: необходимо `перед` командой pip install -r requirements.txt выполнить `pip install cython`. Это связано с тем, что при установке пакетов из requirements.txt они сначала качаются, а только потом устанавливаются. Для примера - описание установки из requirements.txt указано в `Dockerfile` (для linux-систем)
2) Блок лемматизации очень долго обрабатывается
    - Решение: решение разрабатывалось на ubuntu. К сожалению, особенность реализации exe-файла библиотеки pymystem3 для windows такое, что она работает очень долго. К примеру, на одном и том же компьютере на linux лемматизация всего текста заняла 2 секунды, а на windows - 40 минут. К сожалению, при выполнении программы на windows надо подождать очень много времени. Обнаружилось это перед самой отправкой решения. В будущем это можно поправить заменой библиотеки лемматизации - например, на pymorphy2.
3) Ошибка установки: нет gcc или g++ на linux или c++ build tools на windows
    - Решение: необходимо установить перед установкой requirements.txt данные инструменты. Для linux это команда `apt-get install -y gcc g++` (пример установки в `Dockerfile`), для windows - надо установить `Microsoft Visual C++ Build Tools`
